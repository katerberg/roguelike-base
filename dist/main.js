(()=>{var t={361:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>h});var s=i(601),r=i.n(s),o=i(314),n=i.n(o)()(r());n.push([t.id,"canvas{width:100%;height:auto;position:fixed;top:0;left:0}",""]);const h=n},314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",s=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),s&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),s&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,s,r,o){"string"==typeof t&&(t=[[null,t,void 0]]);var n={};if(s)for(var h=0;h<this.length;h++){var l=this[h][0];null!=l&&(n[l]=!0)}for(var a=0;a<t.length;a++){var c=[].concat(t[a]);s&&n[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),i&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=i):c[2]=i),r&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=r):c[4]="".concat(r)),e.push(c))}},e}},601:t=>{"use strict";t.exports=function(t){return t[1]}},452:t=>{var e=function(t){"use strict";var e,i=Object.prototype,s=i.hasOwnProperty,r=Object.defineProperty||function(t,e,i){t[e]=i.value},o="function"==typeof Symbol?Symbol:{},n=o.iterator||"@@iterator",h=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function a(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{a({},"")}catch(t){a=function(t,e,i){return t[e]=i}}function c(t,e,i,s){var o=e&&e.prototype instanceof m?e:m,n=Object.create(o.prototype),h=new V(s||[]);return r(n,"_invoke",{value:M(t,i,h)}),n}function _(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var u="suspendedStart",d="suspendedYield",p="executing",f="completed",g={};function m(){}function v(){}function y(){}var b={};a(b,n,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(R([])));x&&x!==i&&s.call(x,n)&&(b=x);var E=y.prototype=m.prototype=Object.create(b);function C(t){["next","throw","return"].forEach((function(e){a(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function i(r,o,n,h){var l=_(t[r],t,o);if("throw"!==l.type){var a=l.arg,c=a.value;return c&&"object"==typeof c&&s.call(c,"__await")?e.resolve(c.__await).then((function(t){i("next",t,n,h)}),(function(t){i("throw",t,n,h)})):e.resolve(c).then((function(t){a.value=t,n(a)}),(function(t){return i("throw",t,n,h)}))}h(l.arg)}var o;r(this,"_invoke",{value:function(t,s){function r(){return new e((function(e,r){i(t,s,e,r)}))}return o=o?o.then(r,r):r()}})}function M(t,e,i){var s=u;return function(r,o){if(s===p)throw new Error("Generator is already running");if(s===f){if("throw"===r)throw o;return O()}for(i.method=r,i.arg=o;;){var n=i.delegate;if(n){var h=S(n,i);if(h){if(h===g)continue;return h}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(s===u)throw s=f,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);s=p;var l=_(t,e,i);if("normal"===l.type){if(s=i.done?f:d,l.arg===g)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(s=f,i.method="throw",i.arg=l.arg)}}}function S(t,i){var s=i.method,r=t.iterator[s];if(r===e)return i.delegate=null,"throw"===s&&t.iterator.return&&(i.method="return",i.arg=e,S(t,i),"throw"===i.method)||"return"!==s&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+s+"' method")),g;var o=_(r,t.iterator,i.arg);if("throw"===o.type)return i.method="throw",i.arg=o.arg,i.delegate=null,g;var n=o.arg;return n?n.done?(i[t.resultName]=n.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,g):n:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,g)}function K(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function V(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(K,this),this.reset(!0)}function R(t){if(t){var i=t[n];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function i(){for(;++r<t.length;)if(s.call(t,r))return i.value=t[r],i.done=!1,i;return i.value=e,i.done=!0,i};return o.next=o}}return{next:O}}function O(){return{value:e,done:!0}}return v.prototype=y,r(E,"constructor",{value:y,configurable:!0}),r(y,"constructor",{value:v,configurable:!0}),v.displayName=a(y,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,a(t,l,"GeneratorFunction")),t.prototype=Object.create(E),t},t.awrap=function(t){return{__await:t}},C(T.prototype),a(T.prototype,h,(function(){return this})),t.AsyncIterator=T,t.async=function(e,i,s,r,o){void 0===o&&(o=Promise);var n=new T(c(e,i,s,r),o);return t.isGeneratorFunction(i)?n:n.next().then((function(t){return t.done?t.value:n.next()}))},C(E),a(E,l,"Generator"),a(E,n,(function(){return this})),a(E,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),i=[];for(var s in e)i.push(s);return i.reverse(),function t(){for(;i.length;){var s=i.pop();if(s in e)return t.value=s,t.done=!1,t}return t.done=!0,t}},t.values=R,V.prototype={constructor:V,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var i in this)"t"===i.charAt(0)&&s.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function r(s,r){return h.type="throw",h.arg=t,i.next=s,r&&(i.method="next",i.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var n=this.tryEntries[o],h=n.completion;if("root"===n.tryLoc)return r("end");if(n.tryLoc<=this.prev){var l=s.call(n,"catchLoc"),a=s.call(n,"finallyLoc");if(l&&a){if(this.prev<n.catchLoc)return r(n.catchLoc,!0);if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else if(l){if(this.prev<n.catchLoc)return r(n.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return r(n.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&s.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var n=o?o.completion:{};return n.type=t,n.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(n)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),k(i),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var s=i.completion;if("throw"===s.type){var r=s.arg;k(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,i,s){return this.delegate={iterator:R(t),resultName:i,nextLoc:s},"next"===this.method&&(this.arg=e),g}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}},568:(t,e,i)=>{"use strict";i.r(e),i.d(e,{Color:()=>kt,DEFAULT_HEIGHT:()=>J,DEFAULT_WIDTH:()=>$,DIRS:()=>Q,Display:()=>it,Engine:()=>Mt,EventQueue:()=>ot,FOV:()=>ct,KEYS:()=>Z,Lighting:()=>St,Map:()=>yt,Noise:()=>Et,Path:()=>Tt,RNG:()=>l,Scheduler:()=>ht,StringGenerator:()=>st,Text:()=>Vt,Util:()=>Kt});var s={};i.r(s),i.d(s,{capitalize:()=>d,clamp:()=>u,format:()=>p,mod:()=>_});var r={};i.r(r),i.d(r,{add:()=>y,add_:()=>b,fromString:()=>v,hsl2rgb:()=>V,interpolate:()=>E,interpolateHSL:()=>T,lerp:()=>C,lerpHSL:()=>M,multiply:()=>w,multiply_:()=>x,randomize:()=>S,rgb2hsl:()=>K,toHex:()=>O,toRGB:()=>R});var o={};i.r(o),i.d(o,{TYPE_BG:()=>B,TYPE_FG:()=>Y,TYPE_NEWLINE:()=>X,TYPE_TEXT:()=>H,measure:()=>j,tokenize:()=>G});const n=2.3283064365386963e-10;class h{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*n,t=69069*t+1>>>0,this._s1=t*n,t=69069*t+1>>>0,this._s2=t*n,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*n;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c,this._s2}getUniformInt(t,e){let i=Math.max(t,e),s=Math.min(t,e);return Math.floor(this.getUniform()*(i-s+1))+s}getNormal(t=0,e=1){let i,s,r;do{i=2*this.getUniform()-1,s=2*this.getUniform()-1,r=i*i+s*s}while(r>1||0==r);return t+i*Math.sqrt(-2*Math.log(r)/r)*e}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let e=[],i=t.slice();for(;i.length;){let t=i.indexOf(this.getItem(i));e.push(i.splice(t,1)[0])}return e}getWeightedValue(t){let e=0;for(let i in t)e+=t[i];let i,s=this.getUniform()*e,r=0;for(i in t)if(r+=t[i],s<r)return i;return i}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return(new h).setState(this.getState())}}const l=(new h).setSeed(Date.now());class a{getContainer(){return null}setOptions(t){this._options=t}}class c extends a{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const e=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=e,this._updateSize(),this._ctx.font=e,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(t,e){let i=this._ctx.canvas,s=i.getBoundingClientRect();return t-=s.left,e-=s.top,t*=i.width/s.width,e*=i.height/s.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}}function _(t,e){return(t%e+e)%e}function u(t,e=0,i=1){return t<e?e:t>i?i:t}function d(t){return t.charAt(0).toUpperCase()+t.substring(1)}function p(t,...e){let i=p.map;return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,(function(s,r,o,n){if("%"==t.charAt(n-1))return s.substring(1);if(!e.length)return s;let h=e[0],l=(r||o).split(","),a=l.shift()||"",c=i[a.toLowerCase()];if(!c)return s;h=e.shift();let _=h[c].apply(h,l),u=a.charAt(0);return u!=u.toLowerCase()&&(_=d(_)),_}))}p.map={s:"toString"};class f extends c{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,e){let[i,s,r,o,n]=t,h=[(i+1)*this._spacingX,s*this._spacingY+this._hexSize];if(this._options.transpose&&h.reverse(),e&&(this._ctx.fillStyle=n,this._fill(h[0],h[1])),!r)return;this._ctx.fillStyle=o;let l=[].concat(r);for(let t=0;t<l.length;t++)this._ctx.fillText(l[t],h[0],Math.ceil(h[1]))}computeSize(t,e){return this._options.transpose&&(t+=e,t-=e=t-e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]}computeFontSize(t,e){this._options.transpose&&(t+=e,t-=e=t-e);let i=2*t/((this._options.width+1)*Math.sqrt(3))-1,s=e/(2+1.5*(this._options.height-1)),r=Math.min(i,s),o=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let n=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=o;let h=n/100;r=Math.floor(r)+1;let l=2*r/(this._options.spacing*(1+h/Math.sqrt(3)));return Math.ceil(l)-1}_normalizedEventToPosition(t,e){let i;this._options.transpose?(t+=e,t-=e=t-e,i=this._ctx.canvas.width):i=this._ctx.canvas.height;let s=i/this._options.height;return _(e=Math.floor(e/s),2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,e]}_fill(t,e){let i=this._hexSize,s=this._options.border;const r=this._ctx;r.beginPath(),this._options.transpose?(r.moveTo(t-i+s,e),r.lineTo(t-i/2+s,e+this._spacingX-s),r.lineTo(t+i/2-s,e+this._spacingX-s),r.lineTo(t+i-s,e),r.lineTo(t+i/2-s,e-this._spacingX+s),r.lineTo(t-i/2+s,e-this._spacingX+s),r.lineTo(t-i+s,e)):(r.moveTo(t,e-i+s),r.lineTo(t+this._spacingX-s,e-i/2+s),r.lineTo(t+this._spacingX-s,e+i/2-s),r.lineTo(t,e+i-s),r.lineTo(t-this._spacingX+s,e+i/2-s),r.lineTo(t-this._spacingX+s,e-i/2+s),r.lineTo(t,e-i+s)),r.fill()}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);let i,s;this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose?(i="height",s="width"):(i="width",s="height"),this._ctx.canvas[i]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[s]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}const g=(()=>{class t extends c{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(e,i){t.cache?this._drawWithCache(e):this._drawNoCache(e,i)}_drawWithCache(t){let e,[i,s,r,o,n]=t,h=""+r+o+n;if(h in this._canvasCache)e=this._canvasCache[h];else{let t=this._options.border;e=document.createElement("canvas");let i=e.getContext("2d");if(e.width=this._spacingX,e.height=this._spacingY,i.fillStyle=n,i.fillRect(t,t,e.width-t,e.height-t),r){i.fillStyle=o,i.font=this._ctx.font,i.textAlign="center",i.textBaseline="middle";let t=[].concat(r);for(let e=0;e<t.length;e++)i.fillText(t[e],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[h]=e}this._ctx.drawImage(e,i*this._spacingX,s*this._spacingY)}_drawNoCache(t,e){let[i,s,r,o,n]=t;if(e){let t=this._options.border;this._ctx.fillStyle=n,this._ctx.fillRect(i*this._spacingX+t,s*this._spacingY+t,this._spacingX-t,this._spacingY-t)}if(!r)return;this._ctx.fillStyle=o;let h=[].concat(r);for(let t=0;t<h.length;t++)this._ctx.fillText(h[t],(i+.5)*this._spacingX,Math.ceil((s+.5)*this._spacingY))}computeSize(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}computeFontSize(t,e){let i=Math.floor(t/this._options.width),s=Math.floor(e/this._options.height),r=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let o=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=r;let n=o/100*s/i;return n>1&&(s=Math.floor(s/n)),Math.floor(s/this._options.spacing)}_normalizedEventToPosition(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}return t.cache=!1,t})();class m extends c{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,e){let[i,s,r,o,n]=t,h=this._options.tileWidth,l=this._options.tileHeight;if(e&&(this._options.tileColorize?this._ctx.clearRect(i*h,s*l,h,l):(this._ctx.fillStyle=n,this._ctx.fillRect(i*h,s*l,h,l))),!r)return;let a=[].concat(r),c=[].concat(o),_=[].concat(n);for(let t=0;t<a.length;t++){let e=this._options.tileMap[a[t]];if(!e)throw new Error(`Char "${a[t]}" not found in tileMap`);if(this._options.tileColorize){let r=this._colorCanvas,o=r.getContext("2d");o.globalCompositeOperation="source-over",o.clearRect(0,0,h,l);let n=c[t],a=_[t];o.drawImage(this._options.tileSet,e[0],e[1],h,l,0,0,h,l),"transparent"!=n&&(o.fillStyle=n,o.globalCompositeOperation="source-atop",o.fillRect(0,0,h,l)),"transparent"!=a&&(o.fillStyle=a,o.globalCompositeOperation="destination-over",o.fillRect(0,0,h,l)),this._ctx.drawImage(r,i*h,s*l,h,l)}else this._ctx.drawImage(this._options.tileSet,e[0],e[1],h,l,i*h,s*l,h,l)}}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}function v(t){let e,i;if(t in A)e=A[t];else{if("#"==t.charAt(0)){let i=(t.match(/[0-9a-f]/gi)||[]).map((t=>parseInt(t,16)));if(3==i.length)e=i.map((t=>17*t));else{for(let t=0;t<3;t++)i[t+1]+=16*i[t],i.splice(t,1);e=i}}else e=(i=t.match(/rgb\(([0-9, ]+)\)/i))?i[1].split(/\s*,\s*/).map((t=>parseInt(t))):[0,0,0];A[t]=e}return e.slice()}function y(t,...e){let i=t.slice();for(let t=0;t<3;t++)for(let s=0;s<e.length;s++)i[t]+=e[s][t];return i}function b(t,...e){for(let i=0;i<3;i++)for(let s=0;s<e.length;s++)t[i]+=e[s][i];return t}function w(t,...e){let i=t.slice();for(let t=0;t<3;t++){for(let s=0;s<e.length;s++)i[t]*=e[s][t]/255;i[t]=Math.round(i[t])}return i}function x(t,...e){for(let i=0;i<3;i++){for(let s=0;s<e.length;s++)t[i]*=e[s][i]/255;t[i]=Math.round(t[i])}return t}function E(t,e,i=.5){let s=t.slice();for(let r=0;r<3;r++)s[r]=Math.round(s[r]+i*(e[r]-t[r]));return s}const C=E;function T(t,e,i=.5){let s=K(t),r=K(e);for(let t=0;t<3;t++)s[t]+=i*(r[t]-s[t]);return V(s)}const M=T;function S(t,e){e instanceof Array||(e=Math.round(l.getNormal(0,e)));let i=t.slice();for(let t=0;t<3;t++)i[t]+=e instanceof Array?Math.round(l.getNormal(0,e[t])):e;return i}function K(t){let e,i=t[0]/255,s=t[1]/255,r=t[2]/255,o=Math.max(i,s,r),n=Math.min(i,s,r),h=0,l=(o+n)/2;if(o==n)e=0;else{let t=o-n;switch(e=l>.5?t/(2-o-n):t/(o+n),o){case i:h=(s-r)/t+(s<r?6:0);break;case s:h=(r-i)/t+2;break;case r:h=(i-s)/t+4}h/=6}return[h,e,l]}function k(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function V(t){let e=t[2];if(0==t[1])return e=Math.round(255*e),[e,e,e];{let i=t[1],s=e<.5?e*(1+i):e+i-e*i,r=2*e-s,o=k(r,s,t[0]+1/3),n=k(r,s,t[0]),h=k(r,s,t[0]-1/3);return[Math.round(255*o),Math.round(255*n),Math.round(255*h)]}}function R(t){return`rgb(${t.map((t=>u(t,0,255))).join(",")})`}function O(t){return`#${t.map((t=>u(t,0,255).toString(16).padStart(2,"0"))).join("")}`}const A={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};class P extends a{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){alert(t.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let e=this._options.tileSet;e&&"complete"in e&&!e.complete?e.addEventListener("load",(()=>this._updateTexture(e))):this._updateTexture(e)}draw(t,e){const i=this._gl,s=this._options;let[r,o,n,h,l]=t,a=i.canvas.height-(o+1)*s.tileHeight;if(i.scissor(r*s.tileWidth,a,s.tileWidth,s.tileHeight),e&&(s.tileColorize?i.clearColor(0,0,0,0):i.clearColor(...I(l)),i.clear(i.COLOR_BUFFER_BIT)),!n)return;let c=[].concat(n),_=[].concat(l),u=[].concat(h);i.uniform2fv(this._uniforms.targetPosRel,[r,o]);for(let t=0;t<c.length;t++){let e=this._options.tileMap[c[t]];if(!e)throw new Error(`Char "${c[t]}" not found in tileMap`);i.uniform1f(this._uniforms.colorize,s.tileColorize?1:0),i.uniform2fv(this._uniforms.tilesetPosAbs,e),s.tileColorize&&(i.uniform4fv(this._uniforms.tint,I(u[t])),i.uniform4fv(this._uniforms.bg,I(_[t]))),i.drawArrays(i.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...I(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,e){let i=this._gl.canvas,s=i.getBoundingClientRect();return t-=s.left,e-=s.top,t*=i.width/s.width,e*=i.height/s.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let e=function(t,e,i){const s=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(s,e),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(s)||"");const r=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(r)||"");const o=t.createProgram();if(t.attachShader(o,s),t.attachShader(o,r),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(o)||"");return o}(t,N,D);return t.useProgram(e),function(t){const e=new Float32Array([0,0,1,0,0,1,1,1]),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0)}(t),L.forEach((i=>this._uniforms[i]=t.getUniformLocation(e,i))),this._program=e,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._gl,e=this._options,i=[e.width*e.tileWidth,e.height*e.tileHeight];t.canvas.width=i[0],t.canvas.height=i[1],t.viewport(0,0,i[0],i[1]),t.uniform2fv(this._uniforms.tileSize,[e.tileWidth,e.tileHeight]),t.uniform2fv(this._uniforms.targetSize,i)}_updateTexture(t){!function(t,e){let i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}(this._gl,t)}}const L=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],N="\n#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *= -1.0;\n\n\tgl_Position = vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;\n}".trim(),D="\n#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor = vec4(0, 0, 0, 1);\n\n\tvec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a = texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor = texel;\n\t}\n}".trim();let U={};function I(t){if(!(t in U)){let e;if("transparent"==t)e=[0,0,0,0];else if(t.indexOf("rgba")>-1){e=(t.match(/[\d.]+/g)||[]).map(Number);for(let t=0;t<3;t++)e[t]=e[t]/255}else e=v(t).map((t=>t/255)),e.push(1);U[t]=e}return U[t]}function W(t){const e=6/256;let i=v(t);return 36*Math.floor(i[0]*e)+6*Math.floor(i[1]*e)+1*Math.floor(i[2]*e)+16}class F extends a{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let e=[t.width,t.height],i=this.computeSize();this._offset=i.map(((t,i)=>Math.floor((t-e[i])/2)))}clear(){process.stdout.write(`[0;48;5;${W(this._options.bg)}m[2J`)}draw(t,e){let[i,s,r,o,n]=t,h=this._offset[0]+i,l=this._offset[1]+s,a=this.computeSize();if(h<0||h>=a[0])return;if(l<0||l>=a[1])return;if(h===this._cursor[0]&&l===this._cursor[1]||(process.stdout.write(function(t,e){return`[${e+1};${t+1}H`}(h,l)),this._cursor[0]=h,this._cursor[1]=l),e&&(r||(r=" ")),!r)return;let c=function(t,e){return`[0;38;5;${W(t)};48;5;${W(e)}m`}(o,n);if(c!==this._lastColor&&(process.stdout.write(c),this._lastColor=c),"\t"!=r){let t=[].concat(r);process.stdout.write(t[0])}this._cursor[0]++,this._cursor[0]>=a[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,e){return[t,e]}computeSize(){return[process.stdout.columns,process.stdout.rows]}}const z=/%([bc]){([^}]*)}/g,H=0,X=1,Y=2,B=3;function j(t,e){let i={width:0,height:1},s=G(t,e),r=0;for(let t=0;t<s.length;t++){let e=s[t];switch(e.type){case H:r+=e.value.length;break;case X:i.height++,i.width=Math.max(i.width,r),r=0}}return i.width=Math.max(i.width,r),i}function G(t,e){let i=[],s=0;t.replace(z,(function(e,r,o,n){let h=t.substring(s,n);return h.length&&i.push({type:H,value:h}),i.push({type:"c"==r?Y:B,value:o.trim()}),s=n+e.length,""}));let r=t.substring(s);return r.length&&i.push({type:H,value:r}),function(t,e){e||(e=1/0);let i=0,s=0,r=-1;for(;i<t.length;){let o=t[i];if(o.type==X&&(s=0,r=-1),o.type!=H){i++;continue}for(;0==s&&" "==o.value.charAt(0);)o.value=o.value.substring(1);let n=o.value.indexOf("\n");if(-1!=n){o.value=q(t,i,n,!0);let e=o.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();o.value=e.join("")}if(o.value.length){if(s+o.value.length>e){let n=-1;for(;;){let t=o.value.indexOf(" ",n+1);if(-1==t)break;if(s+t>e)break;n=t}if(-1!=n)o.value=q(t,i,n,!0);else if(-1!=r){let e=t[r],s=e.value.lastIndexOf(" ");e.value=q(t,r,s,!0),i=r}else o.value=q(t,i,e-s,!1)}else s+=o.value.length,-1!=o.value.indexOf(" ")&&(r=i);i++}else t.splice(i,1)}t.push({type:X});let o=null;for(let e=0;e<t.length;e++){let i=t[e];switch(i.type){case H:o=i;break;case X:if(o){let t=o.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();o.value=t.join("")}o=null}}return t.pop(),t}(i,e)}function q(t,e,i,s){let r={type:X},o={type:H,value:t[e].value.substring(i+(s?1:0))};return t.splice(e+1,0,r,o),t[e].value.substring(0,i)}let $=80,J=25;const Q={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},Z={VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95},tt={hex:f,rect:g,tile:m,"tile-gl":P,term:F},et={width:$,height:J,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1},it=(()=>{class t{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},et,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,e,i){let s=[this._options.bg,this._options.fg];this.draw(t,e,null,null,s[i%s.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let e=tt[t.layout];this._backend=new e}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,e){return this._backend.computeSize(t,e)}computeFontSize(t,e){return this._backend.computeFontSize(t,e)}computeTileSize(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]}eventToPosition(t){let e,i;return"touches"in t?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY),this._backend.eventToPosition(e,i)}draw(t,e,i,s,r){s||(s=this._options.fg),r||(r=this._options.bg);let o=`${t},${e}`;this._data[o]=[t,e,i,s,r],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[o]=!0)}drawOver(t,e,i,s,r){const o=`${t},${e}`,n=this._data[o];n?(n[2]=i||n[2],n[3]=s||n[3],n[4]=r||n[4]):this.draw(t,e,i,s,r)}drawText(t,e,i,s){let r=null,o=null,n=t,h=e,l=1;s||(s=this._options.width-t);let a=G(i,s);for(;a.length;){let e=a.shift();switch(e.type){case H:let i=!1,s=!1,a=!1,c=!1;for(let t=0;t<e.value.length;t++){let l=e.value.charCodeAt(t),_=e.value.charAt(t);if("term"===this._options.layout){let t=l>>8;if(17===t||t>=46&&t<=159||t>=172&&t<=215||l>=43360&&l<=43391){this.draw(n+0,h,_,r,o),this.draw(n+1,h,"\t",r,o),n+=2;continue}}a=l>65280&&l<65377||l>65500&&l<65512||l>65518,i=32==_.charCodeAt(0)||12288==_.charCodeAt(0),!c||a||i||n++,a&&!s&&n++,this.draw(n++,h,_,r,o),s=i,c=a}break;case Y:r=e.value||null;break;case B:o=e.value||null;break;case X:n=t,h++,l++}}return l}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,e){let i=this._data[t];i[4]!=this._options.bg&&(e=!0),this._backend.draw(i,e)}}return t.Rect=g,t.Hex=f,t.Tile=m,t.TileGL=P,t.Term=F,t})();class st{constructor(t){this._options={words:!1,order:3,prior:.001},Object.assign(this._options,t),this._boundary=String.fromCharCode(0),this._suffix=this._boundary,this._prefix=[];for(let t=0;t<this._options.order;t++)this._prefix.push(this._boundary);this._priorValues={},this._priorValues[this._boundary]=this._options.prior,this._data={}}clear(){this._data={},this._priorValues={}}generate(){let t=[this._sample(this._prefix)];for(;t[t.length-1]!=this._boundary;)t.push(this._sample(t));return this._join(t.slice(0,-1))}observe(t){let e=this._split(t);for(let t=0;t<e.length;t++)this._priorValues[e[t]]=this._options.prior;e=this._prefix.concat(e).concat(this._suffix);for(let t=this._options.order;t<e.length;t++){let i=e.slice(t-this._options.order,t),s=e[t];for(let t=0;t<i.length;t++){let e=i.slice(t);this._observeEvent(e,s)}}}getStats(){let t=[],e=Object.keys(this._priorValues).length;e--,t.push("distinct samples: "+e);let i=Object.keys(this._data).length,s=0;for(let t in this._data)s+=Object.keys(this._data[t]).length;return t.push("dictionary size (contexts): "+i),t.push("dictionary size (events): "+s),t.join(", ")}_split(t){return t.split(this._options.words?/\s+/:"")}_join(t){return t.join(this._options.words?" ":"")}_observeEvent(t,e){let i=this._join(t);i in this._data||(this._data[i]={});let s=this._data[i];e in s||(s[e]=0),s[e]++}_sample(t){t=this._backoff(t);let e=this._join(t),i=this._data[e],s={};if(this._options.prior){for(let t in this._priorValues)s[t]=this._priorValues[t];for(let t in i)s[t]+=i[t]}else s=i;return l.getWeightedValue(s)}_backoff(t){for(t.length>this._options.order?t=t.slice(-this._options.order):t.length<this._options.order&&(t=this._prefix.slice(0,this._options.order-t.length).concat(t));!(this._join(t)in this._data)&&t.length>0;)t=t.slice(1);return t}}class rt{constructor(){this.heap=[],this.timestamp=0}lessThan(t,e){return t.key==e.key?t.timestamp<e.timestamp:t.key<e.key}shift(t){this.heap=this.heap.map((({key:e,value:i,timestamp:s})=>({key:e+t,value:i,timestamp:s})))}len(){return this.heap.length}push(t,e){this.timestamp+=1;const i=this.len();this.heap.push({value:t,timestamp:this.timestamp,key:e}),this.updateUp(i)}pop(){if(0==this.len())throw new Error("no element to pop");const t=this.heap[0];return this.len()>1?(this.heap[0]=this.heap.pop(),this.updateDown(0)):this.heap.pop(),t}find(t){for(let e=0;e<this.len();e++)if(t==this.heap[e].value)return this.heap[e];return null}remove(t){let e=null;for(let i=0;i<this.len();i++)t==this.heap[i].value&&(e=i);if(null===e)return!1;if(this.len()>1){let i=this.heap.pop();return i.value!=t&&(this.heap[e]=i,this.updateDown(e)),!0}return this.heap.pop(),!0}parentNode(t){return Math.floor((t-1)/2)}leftChildNode(t){return 2*t+1}rightChildNode(t){return 2*t+2}existNode(t){return t>=0&&t<this.heap.length}swap(t,e){const i=this.heap[t];this.heap[t]=this.heap[e],this.heap[e]=i}minNode(t){const e=t.filter(this.existNode.bind(this));let i=e[0];for(const t of e)this.lessThan(this.heap[t],this.heap[i])&&(i=t);return i}updateUp(t){if(0==t)return;const e=this.parentNode(t);this.existNode(e)&&this.lessThan(this.heap[t],this.heap[e])&&(this.swap(t,e),this.updateUp(e))}updateDown(t){const e=this.leftChildNode(t),i=this.rightChildNode(t);if(!this.existNode(e))return;const s=this.minNode([t,e,i]);s!=t&&(this.swap(t,s),this.updateDown(s))}debugPrint(){console.log(this.heap)}}class ot{constructor(){this._time=0,this._events=new rt}getTime(){return this._time}clear(){return this._events=new rt,this}add(t,e){this._events.push(t,e)}get(){if(!this._events.len())return null;let{key:t,value:e}=this._events.pop();return t>0&&(this._time+=t,this._events.shift(-t)),e}getEventTime(t){const e=this._events.find(t);if(e){const{key:t}=e;return t}}remove(t){return this._events.remove(t)}}class nt{constructor(){this._queue=new ot,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(t,e){return e&&this._repeat.push(t),this}getTimeOf(t){return this._queue.getEventTime(t)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(t){let e=this._queue.remove(t),i=this._repeat.indexOf(t);return-1!=i&&this._repeat.splice(i,1),this._current==t&&(this._current=null),e}next(){return this._current=this._queue.get(),this._current}}const ht={Simple:class extends nt{add(t,e){return this._queue.add(t,0),super.add(t,e)}next(){return null!==this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),super.next()}},Speed:class extends nt{add(t,e,i){return this._queue.add(t,void 0!==i?i:1/t.getSpeed()),super.add(t,e)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}},Action:class extends nt{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(t,e,i){return this._queue.add(t,i||this._defaultDuration),super.add(t,e)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(t){return t==this._current&&(this._duration=this._defaultDuration),super.remove(t)}next(){return null!==this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(t){return this._current&&(this._duration=t),this}}};class lt{constructor(t,e={}){this._lightPasses=t,this._options=Object.assign({topology:8},e)}_getCircle(t,e,i){let s,r,o,n=[];switch(this._options.topology){case 4:r=1,o=[0,1],s=[Q[8][7],Q[8][1],Q[8][3],Q[8][5]];break;case 6:s=Q[6],r=1,o=[-1,1];break;case 8:s=Q[4],r=2,o=[-1,1];break;default:throw new Error("Incorrect topology for FOV computation")}let h=t+o[0]*i,l=e+o[1]*i;for(let t=0;t<s.length;t++)for(let e=0;e<i*r;e++)n.push([h,l]),h+=s[t][0],l+=s[t][1];return n}}const at=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]],ct={DiscreteShadowcasting:class extends lt{compute(t,e,i,s){if(s(t,e,0,1),!this._lightPasses(t,e))return;let r,o,n,h,l,a=[];for(let c=1;c<=i;c++){let i=this._getCircle(t,e,c),_=360/i.length;for(let t=0;t<i.length;t++)if(n=i[t][0],h=i[t][1],r=_*(t-.5),o=r+_,l=!this._lightPasses(n,h),this._visibleCoords(Math.floor(r),Math.ceil(o),l,a)&&s(n,h,c,1),2==a.length&&0==a[0]&&360==a[1])return}}_visibleCoords(t,e,i,s){if(t<0){let r=this._visibleCoords(0,e,i,s),o=this._visibleCoords(360+t,360,i,s);return r||o}let r=0;for(;r<s.length&&s[r]<t;)r++;if(r==s.length)return i&&s.push(t,e),!0;let o=0;if(r%2){for(;r<s.length&&s[r]<e;)r++,o++;return 0!=o&&(i&&(o%2?s.splice(r-o,o,e):s.splice(r-o,o)),!0)}for(;r<s.length&&s[r]<e;)r++,o++;return(t!=s[r-o]||1!=o)&&(i&&(o%2?s.splice(r-o,o,t):s.splice(r-o,o,t,e)),!0)}},PreciseShadowcasting:class extends lt{compute(t,e,i,s){if(s(t,e,0,1),!this._lightPasses(t,e))return;let r,o,n,h,l,a,c=[];for(let _=1;_<=i;_++){let i=this._getCircle(t,e,_),u=i.length;for(let t=0;t<u;t++)if(r=i[t][0],o=i[t][1],h=[t?2*t-1:2*u-1,2*u],l=[2*t+1,2*u],n=!this._lightPasses(r,o),a=this._checkVisibility(h,l,n,c),a&&s(r,o,_,a),2==c.length&&0==c[0][0]&&c[1][0]==c[1][1])return}}_checkVisibility(t,e,i,s){if(t[0]>e[0])return(this._checkVisibility(t,[t[1],t[1]],i,s)+this._checkVisibility([0,1],e,i,s))/2;let r=0,o=!1;for(;r<s.length;){let e=s[r],i=e[0]*t[1]-t[0]*e[1];if(i>=0){0!=i||r%2||(o=!0);break}r++}let n=s.length,h=!1;for(;n--;){let t=s[n],i=e[0]*t[1]-t[0]*e[1];if(i>=0){0==i&&n%2&&(h=!0);break}}let l,a=!0;if((r==n&&(o||h)||o&&h&&r+1==n&&n%2||r>n&&r%2)&&(a=!1),!a)return 0;let c=n-r+1;if(c%2)if(r%2){let t=s[r];l=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),i&&s.splice(r,c,e)}else{let e=s[n];l=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),i&&s.splice(r,c,t)}else{if(!(r%2))return i&&s.splice(r,c,t,e),1;{let t=s[r],e=s[n];l=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),i&&s.splice(r,c)}}return l/((e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]))}},RecursiveShadowcasting:class extends lt{compute(t,e,i,s){s(t,e,0,1);for(let r=0;r<at.length;r++)this._renderOctant(t,e,at[r],i,s)}compute180(t,e,i,s,r){r(t,e,0,1);let o=(s-1+8)%8,n=(s-2+8)%8,h=(s+1+8)%8;this._renderOctant(t,e,at[n],i,r),this._renderOctant(t,e,at[o],i,r),this._renderOctant(t,e,at[s],i,r),this._renderOctant(t,e,at[h],i,r)}compute90(t,e,i,s,r){r(t,e,0,1);let o=(s-1+8)%8;this._renderOctant(t,e,at[s],i,r),this._renderOctant(t,e,at[o],i,r)}_renderOctant(t,e,i,s,r){this._castVisibility(t,e,1,1,0,s+1,i[0],i[1],i[2],i[3],r)}_castVisibility(t,e,i,s,r,o,n,h,l,a,c){if(!(s<r))for(let _=i;_<=o;_++){let i=-_-1,u=-_,d=!1,p=0;for(;i<=0;){i+=1;let f=t+i*n+u*h,g=e+i*l+u*a,m=(i-.5)/(u+.5),v=(i+.5)/(u-.5);if(!(v>s)){if(m<r)break;if(i*i+u*u<o*o&&c(f,g,_,1),d){if(!this._lightPasses(f,g)){p=v;continue}d=!1,s=p}else!this._lightPasses(f,g)&&_<o&&(d=!0,this._castVisibility(t,e,_+1,s,m,o,n,h,l,a,c),p=v)}}if(d)break}}}};class _t{constructor(t=$,e=J){this._width=t,this._height=e}_fillMap(t){let e=[];for(let i=0;i<this._width;i++){e.push([]);for(let s=0;s<this._height;s++)e[i].push(t)}return e}}class ut extends _t{constructor(t,e){super(t,e),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}class dt{}class pt extends dt{constructor(t,e,i,s,r,o){super(),this._x1=t,this._y1=e,this._x2=i,this._y2=s,this._doors={},void 0!==r&&void 0!==o&&this.addDoor(r,o)}static createRandomAt(t,e,i,s,r){let o=r.roomWidth[0],n=r.roomWidth[1],h=l.getUniformInt(o,n);o=r.roomHeight[0],n=r.roomHeight[1];let a=l.getUniformInt(o,n);if(1==i){let i=e-Math.floor(l.getUniform()*a);return new this(t+1,i,t+h,i+a-1,t,e)}if(-1==i){let i=e-Math.floor(l.getUniform()*a);return new this(t-h,i,t-1,i+a-1,t,e)}if(1==s){let i=t-Math.floor(l.getUniform()*h);return new this(i,e+1,i+h-1,e+a,t,e)}if(-1==s){let i=t-Math.floor(l.getUniform()*h);return new this(i,e-a,i+h-1,e-1,t,e)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(t,e,i){let s=i.roomWidth[0],r=i.roomWidth[1],o=l.getUniformInt(s,r);s=i.roomHeight[0],r=i.roomHeight[1];let n=l.getUniformInt(s,r),h=t-Math.floor(l.getUniform()*o),a=e-Math.floor(l.getUniform()*n);return new this(h,a,h+o-1,a+n-1)}static createRandom(t,e,i){let s=i.roomWidth[0],r=i.roomWidth[1],o=l.getUniformInt(s,r);s=i.roomHeight[0],r=i.roomHeight[1];let n=l.getUniformInt(s,r),h=t-o-1,a=e-n-1,c=1+Math.floor(l.getUniform()*h),_=1+Math.floor(l.getUniform()*a);return new this(c,_,c+o-1,_+n-1)}addDoor(t,e){return this._doors[t+","+e]=1,this}getDoors(t){for(let e in this._doors){let i=e.split(",");t(parseInt(i[0]),parseInt(i[1]))}return this}clearDoors(){return this._doors={},this}addDoors(t){let e=this._x1-1,i=this._x2+1,s=this._y1-1,r=this._y2+1;for(let o=e;o<=i;o++)for(let n=s;n<=r;n++)o!=e&&o!=i&&n!=s&&n!=r||t(o,n)||this.addDoor(o,n);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(t,e){let i=this._x1-1,s=this._x2+1,r=this._y1-1,o=this._y2+1;for(let n=i;n<=s;n++)for(let h=r;h<=o;h++)if(n==i||n==s||h==r||h==o){if(!t(n,h))return!1}else if(!e(n,h))return!1;return!0}create(t){let e=this._x1-1,i=this._x2+1,s=this._y1-1,r=this._y2+1,o=0;for(let n=e;n<=i;n++)for(let h=s;h<=r;h++)o=n+","+h in this._doors?2:n==e||n==i||h==s||h==r?1:0,t(n,h,o)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}class ft extends dt{constructor(t,e,i,s){super(),this._startX=t,this._startY=e,this._endX=i,this._endY=s,this._endsWithAWall=!0}static createRandomAt(t,e,i,s,r){let o=r.corridorLength[0],n=r.corridorLength[1],h=l.getUniformInt(o,n);return new this(t,e,t+i*h,e+s*h)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(t,e){let i=this._startX,s=this._startY,r=this._endX-i,o=this._endY-s,n=1+Math.max(Math.abs(r),Math.abs(o));r&&(r/=Math.abs(r)),o&&(o/=Math.abs(o));let h=o,l=-r,a=!0;for(let c=0;c<n;c++){let _=i+c*r,u=s+c*o;if(e(_,u)||(a=!1),t(_+h,u+l)||(a=!1),t(_-h,u-l)||(a=!1),!a){n=c,this._endX=_-r,this._endY=u-o;break}}if(0==n)return!1;if(1==n&&t(this._endX+r,this._endY+o))return!1;let c=!t(this._endX+r+h,this._endY+o+l),_=!t(this._endX+r-h,this._endY+o-l);return this._endsWithAWall=t(this._endX+r,this._endY+o),!c&&!_||!this._endsWithAWall}create(t){let e=this._startX,i=this._startY,s=this._endX-e,r=this._endY-i,o=1+Math.max(Math.abs(s),Math.abs(r));s&&(s/=Math.abs(s)),r&&(r/=Math.abs(r));for(let n=0;n<o;n++)t(e+n*s,i+n*r,0);return!0}createPriorityWalls(t){if(!this._endsWithAWall)return;let e=this._startX,i=this._startY,s=this._endX-e,r=this._endY-i;s&&(s/=Math.abs(s)),r&&(r/=Math.abs(r));let o=r,n=-s;t(this._endX+s,this._endY+r),t(this._endX+o,this._endY+n),t(this._endX-o,this._endY-n)}}const gt={room:pt,corridor:ft};function mt(t,e,i){i[e[t+1]]=i[t],e[i[t]]=e[t+1],i[t]=t+1,e[t+1]=t}function vt(t,e,i){i[e[t]]=i[t],e[i[t]]=e[t],i[t]=t,e[t]=t}const yt={Arena:class extends _t{create(t){let e=this._width-1,i=this._height-1;for(let s=0;s<=e;s++)for(let r=0;r<=i;r++)t(s,r,s&&r&&s<e&&r<i?0:1);return this}},Uniform:class extends ut{constructor(t,e,i){super(t,e),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,i),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(t){let e=Date.now();for(;;){if(Date.now()-e>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this._map[e][i]);return this}_generateRooms(){let t,e=this._width-2,i=this._height-2;do{if(t=this._generateRoom(),this._dug/(e*i)>this._options.roomDugPercentage)break}while(t)}_generateRoom(){let t=0;for(;t<this._roomAttempts;){t++;let e=pt.createRandom(this._width,this._height,this._options);if(e.isValid(this._isWallCallback,this._canBeDugCallback))return e.create(this._digCallback),this._rooms.push(e),e}return null}_generateCorridors(){let t=0;for(;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(let t=0;t<this._rooms.length;t++){let e=this._rooms[t];e.clearDoors(),e.create(this._digCallback)}for(this._unconnected=l.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let t=l.getItem(this._connected);if(!t)break;let e=this._closestRoom(this._unconnected,t);if(!e)break;let i=this._closestRoom(this._connected,e);if(!i)break;if(!this._connectRooms(e,i))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(t,e){let i=1/0,s=e.getCenter(),r=null;for(let e=0;e<t.length;e++){let o=t[e],n=o.getCenter(),h=n[0]-s[0],l=n[1]-s[1],a=h*h+l*l;a<i&&(i=a,r=o)}return r}_connectRooms(t,e){let i,s,r,o,n,h,l,a=t.getCenter(),c=e.getCenter(),_=c[0]-a[0],u=c[1]-a[1];if(Math.abs(_)<Math.abs(u)?(r=u>0?2:0,o=(r+2)%4,n=e.getLeft(),h=e.getRight(),l=0):(r=_>0?1:3,o=(r+2)%4,n=e.getTop(),h=e.getBottom(),l=1),i=this._placeInWall(t,r),!i)return!1;if(i[l]>=n&&i[l]<=h){s=i.slice();let t=0;switch(o){case 0:t=e.getTop()-1;break;case 1:t=e.getRight()+1;break;case 2:t=e.getBottom()+1;break;case 3:t=e.getLeft()-1}s[(l+1)%2]=t,this._digLine([i,s])}else if(i[l]<n-1||i[l]>h+1){let t=i[l]-c[l],r=0;switch(o){case 0:case 1:r=t<0?3:1;break;case 2:case 3:r=t<0?1:3}if(o=(o+r)%4,s=this._placeInWall(e,o),!s)return!1;let n=[0,0];n[l]=i[l];let h=(l+1)%2;n[h]=s[h],this._digLine([i,n,s])}else{let t=(l+1)%2;if(s=this._placeInWall(e,o),!s)return!1;let r=Math.round((s[t]+i[t])/2),n=[0,0],h=[0,0];n[l]=i[l],n[t]=r,h[l]=s[l],h[t]=r,this._digLine([i,n,h,s])}return t.addDoor(i[0],i[1]),e.addDoor(s[0],s[1]),l=this._unconnected.indexOf(t),-1!=l&&(this._unconnected.splice(l,1),this._connected.push(t)),l=this._unconnected.indexOf(e),-1!=l&&(this._unconnected.splice(l,1),this._connected.push(e)),!0}_placeInWall(t,e){let i=[0,0],s=[0,0],r=0;switch(e){case 0:s=[1,0],i=[t.getLeft(),t.getTop()-1],r=t.getRight()-t.getLeft()+1;break;case 1:s=[0,1],i=[t.getRight()+1,t.getTop()],r=t.getBottom()-t.getTop()+1;break;case 2:s=[1,0],i=[t.getLeft(),t.getBottom()+1],r=t.getRight()-t.getLeft()+1;break;case 3:s=[0,1],i=[t.getLeft()-1,t.getTop()],r=t.getBottom()-t.getTop()+1}let o=[],n=-2;for(let t=0;t<r;t++){let e=i[0]+t*s[0],r=i[1]+t*s[1];o.push(null),1==this._map[e][r]?n!=t-1&&(o[t]=[e,r]):(n=t,t&&(o[t-1]=null))}for(let t=o.length-1;t>=0;t--)o[t]||o.splice(t,1);return o.length?l.getItem(o):null}_digLine(t){for(let e=1;e<t.length;e++){let i=t[e-1],s=t[e],r=new ft(i[0],i[1],s[0],s[1]);r.create(this._digCallback),this._corridors.push(r)}}_digCallback(t,e,i){this._map[t][e]=i,0==i&&this._dug++}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}},Cellular:class extends _t{constructor(t,e,i={}){super(t,e),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(i),this._dirs=Q[this._options.topology],this._map=this._fillMap(0)}randomize(t){for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)this._map[e][i]=l.getUniform()<t?1:0;return this}setOptions(t){Object.assign(this._options,t)}set(t,e,i){this._map[t][e]=i}create(t){let e=this._fillMap(0),i=this._options.born,s=this._options.survive;for(let t=0;t<this._height;t++){let r=1,o=0;6==this._options.topology&&(r=2,o=t%2);for(let n=o;n<this._width;n+=r){let r=this._map[n][t],o=this._getNeighbors(n,t);r&&-1!=s.indexOf(o)?e[n][t]=1:r||-1==i.indexOf(o)||(e[n][t]=1)}}this._map=e,t&&this._serviceCallback(t)}_serviceCallback(t){for(let e=0;e<this._height;e++){let i=1,s=0;6==this._options.topology&&(i=2,s=e%2);for(let r=s;r<this._width;r+=i)t(r,e,this._map[r][e])}}_getNeighbors(t,e){let i=0;for(let s=0;s<this._dirs.length;s++){let r=this._dirs[s],o=t+r[0],n=e+r[1];o<0||o>=this._width||n<0||n>=this._height||(i+=1==this._map[o][n]?1:0)}return i}connect(t,e,i){e||(e=0);let s=[],r={},o=1,n=[0,0];6==this._options.topology&&(o=2,n=[0,1]);for(let t=0;t<this._height;t++)for(let i=n[t%2];i<this._width;i+=o)if(this._freeSpace(i,t,e)){let e=[i,t];r[this._pointKey(e)]=e,s.push([i,t])}let h=s[l.getUniformInt(0,s.length-1)],a=this._pointKey(h),c={};for(c[a]=h,delete r[a],this._findConnected(c,r,[h],!1,e);Object.keys(r).length>0;){let t=this._getFromTo(c,r),s=t[0],o=t[1],n={};n[this._pointKey(s)]=s,this._findConnected(n,r,[s],!0,e),(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,o,s,c,r,e,i);for(let t in n){let i=n[t];this._map[i[0]][i[1]]=e,c[t]=i,delete r[t]}}t&&this._serviceCallback(t)}_getFromTo(t,e){let i,s=[0,0],r=[0,0],o=Object.keys(t),n=Object.keys(e);for(let h=0;h<5;h++){if(o.length<n.length){let i=o;r=t[i[l.getUniformInt(0,i.length-1)]],s=this._getClosest(r,e)}else{let i=n;s=e[i[l.getUniformInt(0,i.length-1)]],r=this._getClosest(s,t)}if(i=(s[0]-r[0])*(s[0]-r[0])+(s[1]-r[1])*(s[1]-r[1]),i<64)break}return[s,r]}_getClosest(t,e){let i=null,s=null;for(let r in e){let o=e[r],n=(o[0]-t[0])*(o[0]-t[0])+(o[1]-t[1])*(o[1]-t[1]);(null==s||n<s)&&(s=n,i=o)}return i}_findConnected(t,e,i,s,r){for(;i.length>0;){let o,n=i.splice(0,1)[0];o=6==this._options.topology?[[n[0]+2,n[1]],[n[0]+1,n[1]-1],[n[0]-1,n[1]-1],[n[0]-2,n[1]],[n[0]-1,n[1]+1],[n[0]+1,n[1]+1]]:[[n[0]+1,n[1]],[n[0]-1,n[1]],[n[0],n[1]+1],[n[0],n[1]-1]];for(let n=0;n<o.length;n++){let h=this._pointKey(o[n]);null==t[h]&&this._freeSpace(o[n][0],o[n][1],r)&&(t[h]=o[n],s||delete e[h],i.push(o[n]))}}}_tunnelToConnected(t,e,i,s,r,o){let n,h;e[0]<t[0]?(n=e,h=t):(n=t,h=e);for(let t=n[0];t<=h[0];t++){this._map[t][n[1]]=r;let e=[t,n[1]],o=this._pointKey(e);i[o]=e,delete s[o]}o&&n[0]<h[0]&&o(n,[h[0],n[1]]);let l=h[0];e[1]<t[1]?(n=e,h=t):(n=t,h=e);for(let t=n[1];t<h[1];t++){this._map[l][t]=r;let e=[l,t],o=this._pointKey(e);i[o]=e,delete s[o]}o&&n[1]<h[1]&&o([h[0],n[1]],[h[0],h[1]])}_tunnelToConnected6(t,e,i,s,r,o){let n,h;e[0]<t[0]?(n=e,h=t):(n=t,h=e);let l=n[0],a=n[1];for(;l!=h[0]||a!=h[1];){let t=2;a<h[1]?(a++,t=1):a>h[1]&&(a--,t=1),l<h[0]?l+=t:l>h[0]||h[1]%2?l-=t:l+=t,this._map[l][a]=r;let e=[l,a],o=this._pointKey(e);i[o]=e,delete s[o]}o&&o(e,t)}_freeSpace(t,e,i){return t>=0&&t<this._width&&e>=0&&e<this._height&&this._map[t][e]==i}_pointKey(t){return t[0]+"."+t[1]}},Digger:class extends ut{constructor(t,e,i={}){super(t,e),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},i),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let e=(this._width-2)*(this._height-2);this._firstRoom();let i,s=Date.now();do{if(i=0,Date.now()-s>this._options.timeLimit)break;let t=this._findWall();if(!t)break;let e=t.split(","),r=parseInt(e[0]),o=parseInt(e[1]),n=this._getDiggingDirection(r,o);if(!n)continue;let h=0;do{if(h++,this._tryFeature(r,o,n[0],n[1])){this._removeSurroundingWalls(r,o),this._removeSurroundingWalls(r-n[0],o-n[1]);break}}while(h<this._featureAttempts);for(let t in this._walls)this._walls[t]>1&&i++}while(this._dug/e<this._options.dugPercentage||i);if(this._addDoors(),t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this._map[e][i]);return this._walls={},this._map=[],this}_digCallback(t,e,i){0==i||2==i?(this._map[t][e]=0,this._dug++):this._walls[t+","+e]=1}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}_priorityWallCallback(t,e){this._walls[t+","+e]=2}_firstRoom(){let t=Math.floor(this._width/2),e=Math.floor(this._height/2),i=pt.createRandomCenter(t,e,this._options);this._rooms.push(i),i.create(this._digCallback)}_findWall(){let t=[],e=[];for(let i in this._walls)2==this._walls[i]?e.push(i):t.push(i);let i=e.length?e:t;if(!i.length)return null;let s=l.getItem(i.sort());return delete this._walls[s],s}_tryFeature(t,e,i,s){let r=l.getWeightedValue(this._features),o=gt[r].createRandomAt(t,e,i,s,this._options);return!!o.isValid(this._isWallCallback,this._canBeDugCallback)&&(o.create(this._digCallback),o instanceof pt&&this._rooms.push(o),o instanceof ft&&(o.createPriorityWalls(this._priorityWallCallback),this._corridors.push(o)),!0)}_removeSurroundingWalls(t,e){let i=Q[4];for(let s=0;s<i.length;s++){let r=i[s],o=t+r[0],n=e+r[1];delete this._walls[o+","+n],o=t+2*r[0],n=e+2*r[1],delete this._walls[o+","+n]}}_getDiggingDirection(t,e){if(t<=0||e<=0||t>=this._width-1||e>=this._height-1)return null;let i=null,s=Q[4];for(let r=0;r<s.length;r++){let o=s[r],n=t+o[0],h=e+o[1];if(!this._map[n][h]){if(i)return null;i=o}}return i?[-i[0],-i[1]]:null}_addDoors(){let t=this._map;function e(e,i){return 1==t[e][i]}for(let t=0;t<this._rooms.length;t++){let i=this._rooms[t];i.clearDoors(),i.addDoors(e)}}},EllerMaze:class extends _t{create(t){let e,i=this._fillMap(1),s=Math.ceil((this._width-2)/2),r=9/24,o=[],n=[];for(let t=0;t<s;t++)o.push(t),n.push(t);for(o.push(s-1),e=1;e+3<this._height;e+=2)for(let t=0;t<s;t++){let s=2*t+1,h=e;i[s][h]=0,t!=o[t+1]&&l.getUniform()>r&&(mt(t,o,n),i[s+1][h]=0),t!=o[t]&&l.getUniform()>r?vt(t,o,n):i[s][h+1]=0}for(let t=0;t<s;t++){let s=2*t+1,h=e;i[s][h]=0,t!=o[t+1]&&(t==o[t]||l.getUniform()>r)&&(mt(t,o,n),i[s+1][h]=0),vt(t,o,n)}for(let e=0;e<this._width;e++)for(let s=0;s<this._height;s++)t(e,s,i[e][s]);return this}},DividedMaze:class extends _t{constructor(){super(...arguments),this._stack=[],this._map=[]}create(t){let e=this._width,i=this._height;this._map=[];for(let t=0;t<e;t++){this._map.push([]);for(let s=0;s<i;s++){let r=0==t||0==s||t+1==e||s+1==i;this._map[t].push(r?1:0)}}this._stack=[[1,1,e-2,i-2]],this._process();for(let s=0;s<e;s++)for(let e=0;e<i;e++)t(s,e,this._map[s][e]);return this._map=[],this}_process(){for(;this._stack.length;){let t=this._stack.shift();this._partitionRoom(t)}}_partitionRoom(t){let e=[],i=[];for(let i=t[0]+1;i<t[2];i++){let s=this._map[i][t[1]-1],r=this._map[i][t[3]+1];!s||!r||i%2||e.push(i)}for(let e=t[1]+1;e<t[3];e++){let s=this._map[t[0]-1][e],r=this._map[t[2]+1][e];!s||!r||e%2||i.push(e)}if(!e.length||!i.length)return;let s=l.getItem(e),r=l.getItem(i);this._map[s][r]=1;let o=[],n=[];o.push(n);for(let e=t[0];e<s;e++)this._map[e][r]=1,e%2&&n.push([e,r]);n=[],o.push(n);for(let e=s+1;e<=t[2];e++)this._map[e][r]=1,e%2&&n.push([e,r]);n=[],o.push(n);for(let e=t[1];e<r;e++)this._map[s][e]=1,e%2&&n.push([s,e]);n=[],o.push(n);for(let e=r+1;e<=t[3];e++)this._map[s][e]=1,e%2&&n.push([s,e]);let h=l.getItem(o);for(let t=0;t<o.length;t++){let e=o[t];if(e==h)continue;let i=l.getItem(e);this._map[i[0]][i[1]]=0}this._stack.push([t[0],t[1],s-1,r-1]),this._stack.push([s+1,t[1],t[2],r-1]),this._stack.push([t[0],r+1,s-1,t[3]]),this._stack.push([s+1,r+1,t[2],t[3]])}},IceyMaze:class extends _t{constructor(t,e,i=0){super(t,e),this._regularity=i,this._map=[]}create(t){let e=this._width,i=this._height,s=this._fillMap(1);e-=e%2?1:2,i-=i%2?1:2;let r=0,o=0,n=0,h=0,a=0,c=!1,_=[[0,0],[0,0],[0,0],[0,0]];do{if(r=1+2*Math.floor(l.getUniform()*(e-1)/2),o=1+2*Math.floor(l.getUniform()*(i-1)/2),a||(s[r][o]=0),!s[r][o]){this._randomize(_);do{0==Math.floor(l.getUniform()*(this._regularity+1))&&this._randomize(_),c=!0;for(let t=0;t<4;t++)if(n=r+2*_[t][0],h=o+2*_[t][1],this._isFree(s,n,h,e,i)){s[n][h]=0,s[r+_[t][0]][o+_[t][1]]=0,r=n,o=h,c=!1,a++;break}}while(!c)}}while(a+1<e*i/4);for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,s[e][i]);return this._map=[],this}_randomize(t){for(let e=0;e<4;e++)t[e][0]=0,t[e][1]=0;switch(Math.floor(4*l.getUniform())){case 0:t[0][0]=-1,t[1][0]=1,t[2][1]=-1,t[3][1]=1;break;case 1:t[3][0]=-1,t[2][0]=1,t[1][1]=-1,t[0][1]=1;break;case 2:t[2][0]=-1,t[3][0]=1,t[0][1]=-1,t[1][1]=1;break;case 3:t[1][0]=-1,t[0][0]=1,t[3][1]=-1,t[2][1]=1}}_isFree(t,e,i,s,r){return!(e<1||i<1||e>=s||i>=r)&&t[e][i]}},Rogue:class extends _t{constructor(t,e,i){super(t,e),this.map=[],this.rooms=[],this.connectedCells=[],(i=Object.assign({cellWidth:3,cellHeight:3},i)).hasOwnProperty("roomWidth")||(i.roomWidth=this._calculateRoomSize(this._width,i.cellWidth)),i.hasOwnProperty("roomHeight")||(i.roomHeight=this._calculateRoomSize(this._height,i.cellHeight)),this._options=i}create(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this.map[e][i]);return this}_calculateRoomSize(t,e){let i=Math.floor(t/e*.8),s=Math.floor(t/e*.25);return s<2&&(s=2),i<2&&(i=2),[s,i]}_initRooms(){for(let t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(let e=0;e<this._options.cellHeight;e++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:e})}}_connectRooms(){let t,e,i,s,r,o,n=l.getUniformInt(0,this._options.cellWidth-1),h=l.getUniformInt(0,this._options.cellHeight-1),a=!1;do{o=[0,2,4,6],o=l.shuffle(o);do{if(a=!1,t=o.pop(),e=n+Q[8][t][0],i=h+Q[8][t][1],!(e<0||e>=this._options.cellWidth||i<0||i>=this._options.cellHeight)){if(s=this.rooms[n][h],s.connections.length>0&&s.connections[0][0]==e&&s.connections[0][1]==i)break;r=this.rooms[e][i],0==r.connections.length&&(r.connections.push([n,h]),this.connectedCells.push([e,i]),n=e,h=i,a=!0)}}while(o.length>0&&0==a)}while(o.length>0)}_connectUnconnectedRooms(){let t,e,i,s=this._options.cellWidth,r=this._options.cellHeight;this.connectedCells=l.shuffle(this.connectedCells);for(let o=0;o<this._options.cellWidth;o++)for(let n=0;n<this._options.cellHeight;n++)if(t=this.rooms[o][n],0==t.connections.length){let h=[0,2,4,6];h=l.shuffle(h),i=!1;do{let t=h.pop(),l=o+Q[8][t][0],a=n+Q[8][t][1];if(!(l<0||l>=s||a<0||a>=r)){if(e=this.rooms[l][a],i=!0,0==e.connections.length)break;for(let t=0;t<e.connections.length;t++)if(e.connections[t][0]==o&&e.connections[t][1]==n){i=!1;break}if(i)break}}while(h.length);i?t.connections.push([e.cellx,e.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let t,e,i,s,r,o=this._width,n=this._height,h=this._options.cellWidth,a=this._options.cellHeight,c=Math.floor(this._width/h),_=Math.floor(this._height/a),u=this._options.roomWidth,d=this._options.roomHeight;for(let p=0;p<h;p++)for(let h=0;h<a;h++){if(i=c*p,s=_*h,0==i&&(i=1),0==s&&(s=1),t=l.getUniformInt(u[0],u[1]),e=l.getUniformInt(d[0],d[1]),h>0)for(r=this.rooms[p][h-1];s-(r.y+r.height)<3;)s++;if(p>0)for(r=this.rooms[p-1][h];i-(r.x+r.width)<3;)i++;let a=Math.round(l.getUniformInt(0,c-t)/2),f=Math.round(l.getUniformInt(0,_-e)/2);for(;i+a+t>=o;)a?a--:t--;for(;s+f+e>=n;)f?f--:e--;i+=a,s+=f,this.rooms[p][h].x=i,this.rooms[p][h].y=s,this.rooms[p][h].width=t,this.rooms[p][h].height=e;for(let r=i;r<i+t;r++)for(let t=s;t<s+e;t++)this.map[r][t]=0}}_getWallPosition(t,e){let i,s,r;return 1==e||3==e?(i=l.getUniformInt(t.x+1,t.x+t.width-2),1==e?(s=t.y-2,r=s+1):(s=t.y+t.height+1,r=s-1),this.map[i][r]=0):(s=l.getUniformInt(t.y+1,t.y+t.height-2),2==e?(i=t.x+t.width+1,r=i-1):(i=t.x-2,r=i+1),this.map[r][s]=0),[i,s]}_drawCorridor(t,e){let i,s,r,o,n=e[0]-t[0],h=e[1]-t[1],a=t[0],c=t[1],_=[],u=Math.abs(n),d=Math.abs(h),p=l.getUniform(),f=p,g=1-p;for(s=n>0?2:6,r=h>0?4:0,u<d?(i=Math.ceil(d*f),_.push([r,i]),_.push([s,u]),i=Math.floor(d*g),_.push([r,i])):(i=Math.ceil(u*f),_.push([s,i]),_.push([r,d]),i=Math.floor(u*g),_.push([s,i])),this.map[a][c]=0;_.length>0;)for(o=_.pop();o[1]>0;)a+=Q[8][o[0]][0],c+=Q[8][o[0]][1],this.map[a][c]=0,o[1]=o[1]-1}_createCorridors(){let t,e,i,s,r,o=this._options.cellWidth,n=this._options.cellHeight;for(let h=0;h<o;h++)for(let o=0;o<n;o++){t=this.rooms[h][o];for(let o=0;o<t.connections.length;o++)e=t.connections[o],i=this.rooms[e[0]][e[1]],i.cellx>t.cellx?(s=2,r=4):i.cellx<t.cellx?(s=4,r=2):i.celly>t.celly?(s=3,r=1):(s=1,r=3),this._drawCorridor(this._getWallPosition(t,s),this._getWallPosition(i,r))}}}};class bt{}const wt=.5*(Math.sqrt(3)-1),xt=(3-Math.sqrt(3))/6,Et={Simplex:class extends bt{constructor(t=256){super(),this._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];let e=[];for(let i=0;i<t;i++)e.push(i);e=l.shuffle(e),this._perms=[],this._indexes=[];for(let i=0;i<2*t;i++)this._perms.push(e[i%t]),this._indexes.push(this._perms[i]%this._gradients.length)}get(t,e){let i,s,r,o=this._perms,n=this._indexes,h=o.length/2,l=0,a=0,c=0,u=(t+e)*wt,d=Math.floor(t+u),p=Math.floor(e+u),f=(d+p)*xt,g=t-(d-f),m=e-(p-f);g>m?(s=1,r=0):(s=0,r=1);let v=g-s+xt,y=m-r+xt,b=g-1+2*xt,w=m-1+2*xt,x=_(d,h),E=_(p,h),C=.5-g*g-m*m;if(C>=0){C*=C,i=n[x+o[E]];let t=this._gradients[i];l=C*C*(t[0]*g+t[1]*m)}let T=.5-v*v-y*y;if(T>=0){T*=T,i=n[x+s+o[E+r]];let t=this._gradients[i];a=T*T*(t[0]*v+t[1]*y)}let M=.5-b*b-w*w;if(M>=0){M*=M,i=n[x+1+o[E+1]];let t=this._gradients[i];c=M*M*(t[0]*b+t[1]*w)}return 70*(l+a+c)}}};class Ct{constructor(t,e,i,s={}){this._toX=t,this._toY=e,this._passableCallback=i,this._options=Object.assign({topology:8},s),this._dirs=Q[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])}_getNeighbors(t,e){let i=[];for(let s=0;s<this._dirs.length;s++){let r=this._dirs[s],o=t+r[0],n=e+r[1];this._passableCallback(o,n)&&i.push([o,n])}return i}}const Tt={Dijkstra:class extends Ct{constructor(t,e,i,s){super(t,e,i,s),this._computed={},this._todo=[],this._add(t,e,null)}compute(t,e,i){let s=t+","+e;if(s in this._computed||this._compute(t,e),!(s in this._computed))return;let r=this._computed[s];for(;r;)i(r.x,r.y),r=r.prev}_compute(t,e){for(;this._todo.length;){let i=this._todo.shift();if(i.x==t&&i.y==e)return;let s=this._getNeighbors(i.x,i.y);for(let t=0;t<s.length;t++){let e=s[t],r=e[0],o=e[1];r+","+o in this._computed||this._add(r,o,i)}}}_add(t,e,i){let s={x:t,y:e,prev:i};this._computed[t+","+e]=s,this._todo.push(s)}},AStar:class extends Ct{constructor(t,e,i,s={}){super(t,e,i,s),this._todo=[],this._done={}}compute(t,e,i){for(this._todo=[],this._done={},this._fromX=t,this._fromY=e,this._add(this._toX,this._toY,null);this._todo.length;){let i=this._todo.shift(),s=i.x+","+i.y;if(s in this._done)continue;if(this._done[s]=i,i.x==t&&i.y==e)break;let r=this._getNeighbors(i.x,i.y);for(let t=0;t<r.length;t++){let e=r[t],s=e[0],o=e[1];s+","+o in this._done||this._add(s,o,i)}}let s=this._done[t+","+e];if(s)for(;s;)i(s.x,s.y),s=s.prev}_add(t,e,i){let s=this._distance(t,e),r={x:t,y:e,prev:i,g:i?i.g+1:0,h:s},o=r.g+r.h;for(let t=0;t<this._todo.length;t++){let e=this._todo[t],i=e.g+e.h;if(o<i||o==i&&s<e.h)return void this._todo.splice(t,0,r)}this._todo.push(r)}_distance(t,e){switch(this._options.topology){case 4:return Math.abs(t-this._fromX)+Math.abs(e-this._fromY);case 6:let i=Math.abs(t-this._fromX),s=Math.abs(e-this._fromY);return s+Math.max(0,(i-s)/2);case 8:return Math.max(Math.abs(t-this._fromX),Math.abs(e-this._fromY))}}}};class Mt{constructor(t){this._scheduler=t,this._lock=1}start(){return this.unlock()}lock(){return this._lock++,this}unlock(){if(!this._lock)throw new Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){let t=this._scheduler.next();if(!t)return this.lock();let e=t.act();e&&e.then&&(this.lock(),e.then(this.unlock.bind(this)))}return this}}class St{constructor(t,e={}){this._reflectivityCallback=t,this._options={},e=Object.assign({passes:1,emissionThreshold:100,range:10},e),this._lights={},this._reflectivityCache={},this._fovCache={},this.setOptions(e)}setOptions(t){return Object.assign(this._options,t),t&&t.range&&this.reset(),this}setFOV(t){return this._fov=t,this._fovCache={},this}setLight(t,e,i){let s=t+","+e;return i?this._lights[s]="string"==typeof i?v(i):i:delete this._lights[s],this}clearLights(){this._lights={}}reset(){return this._reflectivityCache={},this._fovCache={},this}compute(t){let e={},i={},s={};for(let t in this._lights){let e=this._lights[t];i[t]=[0,0,0],b(i[t],e)}for(let t=0;t<this._options.passes;t++)this._emitLight(i,s,e),t+1!=this._options.passes&&(i=this._computeEmitters(s,e));for(let e in s){let i=e.split(",");t(parseInt(i[0]),parseInt(i[1]),s[e])}return this}_emitLight(t,e,i){for(let s in t){let r=s.split(","),o=parseInt(r[0]),n=parseInt(r[1]);this._emitLightFromCell(o,n,t[s],e),i[s]=1}return this}_computeEmitters(t,e){let i={};for(let s in t){if(s in e)continue;let r,o=t[s];if(s in this._reflectivityCache)r=this._reflectivityCache[s];else{let t=s.split(","),e=parseInt(t[0]),i=parseInt(t[1]);r=this._reflectivityCallback(e,i),this._reflectivityCache[s]=r}if(0==r)continue;let n=[0,0,0],h=0;for(let t=0;t<3;t++){let e=Math.round(o[t]*r);n[t]=e,h+=e}h>this._options.emissionThreshold&&(i[s]=n)}return i}_emitLightFromCell(t,e,i,s){let r,o=t+","+e;r=o in this._fovCache?this._fovCache[o]:this._updateFOV(t,e);for(let t in r){let e,o=r[t];t in s?e=s[t]:(e=[0,0,0],s[t]=e);for(let t=0;t<3;t++)e[t]+=Math.round(i[t]*o)}return this}_updateFOV(t,e){let i=t+","+e,s={};this._fovCache[i]=s;let r=this._options.range;return this._fov.compute(t,e,r,function(t,e,i,o){let n=o*(1-i/r);0!=n&&(s[t+","+e]=n)}.bind(this)),s}}const Kt=s,kt=r,Vt=o},54:(t,e,i)=>{var s=i(72),r=i(361);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.id,r,""]]);s(r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},72:(t,e,i)=>{"use strict";var s,r=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}(),o=[];function n(t){for(var e=-1,i=0;i<o.length;i++)if(o[i].identifier===t){e=i;break}return e}function h(t,e){for(var i={},s=[],r=0;r<t.length;r++){var h=t[r],l=e.base?h[0]+e.base:h[0],a=i[l]||0,c="".concat(l," ").concat(a);i[l]=a+1;var _=n(c),u={css:h[1],media:h[2],sourceMap:h[3]};-1!==_?(o[_].references++,o[_].updater(u)):o.push({identifier:c,updater:f(u,e),references:1}),s.push(c)}return s}function l(t){var e=document.createElement("style"),s=t.attributes||{};if(void 0===s.nonce){var o=i.nc;o&&(s.nonce=o)}if(Object.keys(s).forEach((function(t){e.setAttribute(t,s[t])})),"function"==typeof t.insert)t.insert(e);else{var n=r(t.insert||"head");if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(e)}return e}var a,c=(a=[],function(t,e){return a[t]=e,a.filter(Boolean).join("\n")});function _(t,e,i,s){var r=i?"":s.media?"@media ".concat(s.media," {").concat(s.css,"}"):s.css;if(t.styleSheet)t.styleSheet.cssText=c(e,r);else{var o=document.createTextNode(r),n=t.childNodes;n[e]&&t.removeChild(n[e]),n.length?t.insertBefore(o,n[e]):t.appendChild(o)}}function u(t,e,i){var s=i.css,r=i.media,o=i.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=s;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(s))}}var d=null,p=0;function f(t,e){var i,s,r;if(e.singleton){var o=p++;i=d||(d=l(e)),s=_.bind(null,i,o,!1),r=_.bind(null,i,o,!0)}else i=l(e),s=u.bind(null,i,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return s(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;s(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=(void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s));var i=h(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var s=0;s<i.length;s++){var r=n(i[s]);o[r].references--}for(var l=h(t,e),a=0;a<i.length;a++){var c=n(i[a]);0===o[c].references&&(o[c].updater(),o.splice(c,1))}i=l}}}},484:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Game=void 0,i(452);var s=i(568),r=i(270);e.Game=function(){this.display=new s.Display({width:r.dimensions.WIDTH,height:r.dimensions.HEIGHT});var t=this.display.getContainer();t&&document.body.appendChild(t)}},270:function(t,e){"use strict";var i=this&&this.__assign||function(){return i=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},i.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.xpLevels=e.enemies=e.gearTypes=e.modalChoices=e.symbols=e.dimensions=e.validMenuKeymap=e.validKeymap=e.movementKeymap=e.colors=void 0,e.colors={BLACK:"#000",YELLOW:"#ff0",GREEN:"#0f0",RED:"#f00",WHITE:"#fefefe",ORANGE:"#FF7034",FADED_WHITE:"#777"},e.movementKeymap={38:0,75:0,87:0,39:1,76:1,68:1,40:2,74:2,83:2,37:3,72:3,65:3},e.validKeymap=i(i({},e.movementKeymap),{71:"Gear",73:"Gear",27:"Menu",77:"Menu"}),e.validMenuKeymap=i(i({},e.movementKeymap),{27:"Cancel",77:"Cancel",13:"Select",32:"Select"}),e.dimensions={HEIGHT:25,WIDTH:80},e.symbols={WALL:"█",POTION:"ɋ",WEAPON:"Ψ",ARMOR:"Θ",AMULET:"ϙ",OPEN:".",PLAYER:"@",ENEMY:"D",MODAL_CORNER_TOP_LEFT:"◸",MODAL_CORNER_TOP_RIGHT:"◹",MODAL_CORNER_BOTTOM_LEFT:"◺",MODAL_CORNER_BOTTOM_RIGHT:"◿",MODAL_Y:"|",MODAL_X:"-",LADDER:"▤",BULLET:"▶"},e.modalChoices={yn:{89:!0,78:!1}},e.gearTypes={Armor:5,Weapon:5,Amulet:1},e.enemies={GOBLIN:{type:"Goblin",stats:{strength:1,dexterity:1,maxHp:3},xp:1,dropPercentage:10,color:e.colors.RED},SKELETON:{type:"Skeleton",stats:{strength:2,dexterity:5,maxHp:4},xp:3,dropPercentage:5,color:e.colors.RED},TROLL:{type:"Troll",stats:{strength:5,dexterity:0,maxHp:25},xp:10,dropPercentage:30,color:e.colors.RED},DRAGON:{type:"Dragon",stats:{strength:17,dexterity:10,maxHp:40},xp:30,dropPercentage:80,color:e.colors.RED},BALROG:{type:"Balrog",stats:{strength:25,dexterity:40,maxHp:80},xp:0,dropPercentage:0,color:e.colors.ORANGE}},e.xpLevels={1:2,2:6,3:15,4:45,5:70,6:100,7:155,8:200,9:283,10:334,11:444,12:576,13:733,14:915,15:1125,16:1366,17:4913,18:5832,19:6859}}},e={};function i(s){var r=e[s];if(void 0!==r)return r.exports;var o=e[s]={id:s,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nc=void 0,(()=>{"use strict";i(54),new(i(484).Game)})()})();